"use strict";(()=>{var e={};e.id=278,e.ids=[278],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3263:e=>{e.exports=import("firebase-admin/app")},2929:e=>{e.exports=import("firebase-admin/firestore")},2941:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>u});var r=a(2411),n=a(7081),o=a(6224),p=a(3207),i=e([p]);p=(i.then?(await i)():i)[0];let l=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/guests/send-all-whatsapp/route",pathname:"/api/guests/send-all-whatsapp",filename:"route",bundlePath:"app/api/guests/send-all-whatsapp/route"},resolvedPagePath:"C:\\Users\\jaime.andre\\Documents\\As Minhas Formas\\downloads\\gestor-convidados\\app\\api\\guests\\send-all-whatsapp\\route.ts",nextConfigOutput:"",userland:p}),{requestAsyncStorage:d,staticGenerationAsyncStorage:u,serverHooks:h}=l,m="/api/guests/send-all-whatsapp/route";function c(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:u})}s()}catch(e){s(e)}})},3207:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{POST:()=>p});var r=a(3120),n=a(1068),o=e([n]);async function p(){try{let e=process.env.APP_BASE_URL||"http://localhost:3000",t=(await n.i.collection("guests").get()).docs.map(e=>({id:e.id,...e.data()})),a=0,s=0,o=0;for(let r of t)try{let t=r.whatsapp||r.phone||null;if(!t||!r.token){s++;continue}await sendWhatsAppWithQr({name:r.fullName,phone:t,token:r.token,appBase:e}),a++}catch{o++}return r.NextResponse.json({ok:!0,sent:a,skipped:s,failed:o})}catch(e){return console.error(e),r.NextResponse.json({error:e.message||"Erro no envio em massa do WhatsApp."},{status:500})}}n=(o.then?(await o)():o)[0],s()}catch(e){s(e)}})},1068:(e,t,a)=>{a.a(e,async(e,s)=>{try{let p;a.d(t,{i:()=>i});var r=a(3263),n=a(2929),o=e([r,n]);if([r,n]=o.then?(await o)():o,(0,r.getApps)().length)p=(0,r.getApps)()[0];else{let e=process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n");process.env.FIREBASE_PROJECT_ID&&process.env.FIREBASE_CLIENT_EMAIL&&e||console.warn("[firebase-admin] Credenciais incompletas. APIs protegidas podem falhar."),p=(0,r.initializeApp)({credential:(0,r.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e})})}let i=(0,n.getFirestore)(p);s()}catch(e){s(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[860,642],()=>a(2941));module.exports=s})();