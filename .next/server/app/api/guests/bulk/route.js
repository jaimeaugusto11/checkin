"use strict";(()=>{var e={};e.id=592,e.ids=[592],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3263:e=>{e.exports=import("firebase-admin/app")},2929:e=>{e.exports=import("firebase-admin/firestore")},9491:e=>{e.exports=require("assert")},852:e=>{e.exports=require("async_hooks")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},4492:e=>{e.exports=require("node:stream")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},775:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>h});var s=r(2411),i=r(7081),a=r(6224),o=r(7256),c=e([o]);o=(c.then?(await c)():c)[0];let l=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/guests/bulk/route",pathname:"/api/guests/bulk",filename:"route",bundlePath:"app/api/guests/bulk/route"},resolvedPagePath:"C:\\Users\\jaime.andre\\Documents\\As Minhas Formas\\downloads\\gestor-convidados\\app\\api\\guests\\bulk\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:p}=l,m="/api/guests/bulk/route";function u(){return(0,a.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:h})}n()}catch(e){n(e)}})},7256:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{POST:()=>u});var s=r(3120),i=r(1068),a=r(2135),o=r(6999),c=e([i]);async function u(e){try{let{rows:t,sendEmails:r}=await e.json();if(!Array.isArray(t)||0===t.length)return s.NextResponse.json({error:"Sem dados para importar."},{status:400});let n=Date.now(),c=i.i.bulkWriter();for(let e of t){if(!e?.fullName||!e?.email)continue;let t=e.email.toLowerCase(),s=await i.i.collection("guests").where("email","==",t).limit(1).get();if(!s.empty){let i=s.docs[0];if(c.update(i.ref,{fullName:e.fullName,whatsapp:e.whatsapp||null,category:e.category||null,updatedAt:n}),r){let r=i.data();await (0,o.s)(t,e.fullName,r.token),c.update(i.ref,{inviteSentAt:Date.now(),status:"invited"})}continue}let u=i.i.collection("guests").doc(),l=(0,a.f)(u.id,t);c.set(u,{fullName:e.fullName,email:t,whatsapp:e.whatsapp||null,category:e.category||null,status:"invited",createdAt:n,updatedAt:n,checkInAt:null,inviteSentAt:r?n:null,token:l}),r&&await (0,o.s)(t,e.fullName,l)}return await c.close(),s.NextResponse.json({ok:!0})}catch(e){return console.error(e),s.NextResponse.json({error:e.message||"Erro na importa\xe7\xe3o."},{status:500})}}i=(c.then?(await c)():c)[0],n()}catch(e){n(e)}})},6999:(e,t,r)=>{r.d(t,{s:()=>a});var n=r(6596),s=r(3697);let i=process.env.RESEND_API_KEY?new s.R(process.env.RESEND_API_KEY):null;async function a(e,t,r){if(!i)return;let s=process.env.EVENT_NAME||"IMERS\xc3O JURIDICA",a=process.env.APP_BASE_URL||"http://localhost:3000",o=await n.toBuffer(r,{type:"png"}),c=`
  <div style="font-family:Arial,Helvetica,sans-serif; max-width:600px; margin:auto;">
    <h2 style="margin:0 0 8px">Convite: ${s}</h2>
    <p style="margin:0 0 12px">Ol\xe1 <b>${t}</b>,</p>
    <p style="margin:0 0 16px">O seu QR de check-in est\xe1 em anexo e tamb\xe9m incorporado abaixo:</p>
    <p style="text-align:center; margin:16px 0">
      <img src="cid:qrcode" alt="QR Code" style="max-width:200px; width:100%; height:auto" />
    </p>
    <p style="margin:16px 0">Ou aceda diretamente:
      <a href="${a}/checkin?token=${encodeURIComponent(r)}">
        ${a}/checkin?token=${encodeURIComponent(r)}
      </a>
    </p>
    <hr />
    <small>Se n\xe3o reconhece este convite, ignore este e-mail.</small>
  </div>`;await i.emails.send({from:process.env.EMAIL_FROM||"Convites <no-reply@example.com>",to:[e],subject:`Convite - ${s}`,html:c,reply_to:process.env.EMAIL_REPLY_TO||void 0,attachments:[{filename:"qrcode.png",content:o.toString("base64"),encoding:"base64",cid:"qrcode"}]})}},1068:(e,t,r)=>{r.a(e,async(e,n)=>{try{let o;r.d(t,{i:()=>c});var s=r(3263),i=r(2929),a=e([s,i]);if([s,i]=a.then?(await a)():a,(0,s.getApps)().length)o=(0,s.getApps)()[0];else{let e=process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n");process.env.FIREBASE_PROJECT_ID&&process.env.FIREBASE_CLIENT_EMAIL&&e||console.warn("[firebase-admin] Credenciais incompletas. APIs protegidas podem falhar."),o=(0,s.initializeApp)({credential:(0,s.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e})})}let c=(0,i.getFirestore)(o);n()}catch(e){n(e)}})},2135:(e,t,r)=>{r.d(t,{W:()=>a,f:()=>i});var n=r(6113),s=r.n(n);function i(e,t){let r=process.env.CHECKIN_SECRET||"dev-secret",n=`${e}.${t.toLowerCase()}`,i=s().createHmac("sha256",r).update(n).digest("hex");return`${e}.${i}`}function a(e,t){let[r,n]=e.split(".");if(!r||!n)return{ok:!1,guestId:null};let a=i(r,t).split(".")[1];return{ok:s().timingSafeEqual(Buffer.from(n),Buffer.from(a)),guestId:r}}},3697:(e,t,r)=>{r.d(t,{R:()=>A});var n=Object.defineProperty,s=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&u(e,r,t[r]);if(a)for(var r of a(t))c.call(t,r)&&u(e,r,t[r]);return e},d=(e,t)=>s(e,i(t)),h=(e,t,r)=>new Promise((n,s)=>{var i=e=>{try{o(r.next(e))}catch(e){s(e)}},a=e=>{try{o(r.throw(e))}catch(e){s(e)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,a);o((r=r.apply(e,t)).next())}),p=class{constructor(e){this.resend=e}create(e){return h(this,arguments,function*(e,t={}){return yield this.resend.post("/api-keys",e,t)})}list(){return h(this,null,function*(){return yield this.resend.get("/api-keys")})}remove(e){return h(this,null,function*(){return yield this.resend.delete(`/api-keys/${e}`)})}},m=class{constructor(e){this.resend=e}create(e){return h(this,arguments,function*(e,t={}){return yield this.resend.post("/audiences",e,t)})}list(){return h(this,null,function*(){return yield this.resend.get("/audiences")})}get(e){return h(this,null,function*(){return yield this.resend.get(`/audiences/${e}`)})}remove(e){return h(this,null,function*(){return yield this.resend.delete(`/audiences/${e}`)})}},f=class{constructor(e){this.resend=e}send(e){return h(this,arguments,function*(e,t={}){return this.create(e,t)})}create(e){return h(this,arguments,function*(e,t={}){for(let t of e)if(t.react){if(!this.renderAsync)try{let{renderAsync:e}=yield r.e(942).then(r.bind(r,9942));this.renderAsync=e}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}t.html=yield this.renderAsync(t.react),t.react=void 0}return yield this.resend.post("/emails/batch",e,t)})}},y=class{constructor(e){this.resend=e}create(e){return h(this,arguments,function*(e,t={}){return yield this.resend.post(`/audiences/${e.audienceId}/contacts`,{unsubscribed:e.unsubscribed,email:e.email,first_name:e.firstName,last_name:e.lastName},t)})}list(e){return h(this,null,function*(){return yield this.resend.get(`/audiences/${e.audienceId}/contacts`)})}get(e){return h(this,null,function*(){return yield this.resend.get(`/audiences/${e.audienceId}/contacts/${e.id}`)})}update(e){return h(this,null,function*(){return yield this.resend.patch(`/audiences/${e.audienceId}/contacts/${e.id}`,{unsubscribed:e.unsubscribed,first_name:e.firstName,last_name:e.lastName})})}remove(e){return h(this,null,function*(){return yield this.resend.delete(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`)})}},g=class{constructor(e){this.resend=e}create(e){return h(this,arguments,function*(e,t={}){return yield this.resend.post("/domains",e,t)})}list(){return h(this,null,function*(){return yield this.resend.get("/domains")})}get(e){return h(this,null,function*(){return yield this.resend.get(`/domains/${e}`)})}update(e){return h(this,null,function*(){return yield this.resend.patch(`/domains/${e.id}`,{click_tracking:e.clickTracking,open_tracking:e.openTracking,tls:e.tls})})}remove(e){return h(this,null,function*(){return yield this.resend.delete(`/domains/${e}`)})}verify(e){return h(this,null,function*(){return yield this.resend.post(`/domains/${e}/verify`)})}},v=class{constructor(e){this.resend=e}send(e){return h(this,arguments,function*(e,t={}){return this.create(e,t)})}create(e){return h(this,arguments,function*(e,t={}){if(e.react){if(!this.renderAsync)try{let{renderAsync:e}=yield r.e(942).then(r.bind(r,9942));this.renderAsync=e}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}e.html=yield this.renderAsync(e.react)}return yield this.resend.post("/emails",{attachments:e.attachments,bcc:e.bcc,cc:e.cc,from:e.from,headers:e.headers,html:e.html,reply_to:e.replyTo,scheduled_at:e.scheduledAt,subject:e.subject,tags:e.tags,text:e.text,to:e.to},t)})}get(e){return h(this,null,function*(){return yield this.resend.get(`/emails/${e}`)})}update(e){return h(this,null,function*(){return yield this.resend.patch(`/emails/${e.id}`,{scheduled_at:e.scheduledAt})})}cancel(e){return h(this,null,function*(){return yield this.resend.post(`/emails/${e}/cancel`)})}},E="undefined"!=typeof process&&process.env&&process.env.RESEND_BASE_URL||"https://api.resend.com",b="undefined"!=typeof process&&process.env&&process.env.RESEND_USER_AGENT||"resend-node:4.0.1",A=class{constructor(e){if(this.key=e,this.apiKeys=new p(this),this.audiences=new m(this),this.batch=new f(this),this.contacts=new y(this),this.domains=new g(this),this.emails=new v(this),!e&&("undefined"!=typeof process&&process.env&&(this.key=process.env.RESEND_API_KEY),!this.key))throw Error('Missing API key. Pass it to the constructor `new Resend("re_123")`');this.headers=new Headers({Authorization:`Bearer ${this.key}`,"User-Agent":b,"Content-Type":"application/json"})}fetchRequest(e){return h(this,arguments,function*(e,t={}){try{let r=yield fetch(`${E}${e}`,t);if(!r.ok)try{let e=yield r.text();return{data:null,error:JSON.parse(e)}}catch(t){if(t instanceof SyntaxError)return{data:null,error:{name:"application_error",message:"Internal server error. We are unable to process your request right now, please try again later."}};let e={message:r.statusText,name:"application_error"};if(t instanceof Error)return{data:null,error:d(l({},e),{message:t.message})};return{data:null,error:e}}return{data:yield r.json(),error:null}}catch(e){return{data:null,error:{name:"application_error",message:"Unable to fetch data. The request could not be resolved."}}}})}post(e,t){return h(this,arguments,function*(e,t,r={}){let n=l({method:"POST",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,n)})}get(e){return h(this,arguments,function*(e,t={}){let r=l({method:"GET",headers:this.headers},t);return this.fetchRequest(e,r)})}put(e,t){return h(this,arguments,function*(e,t,r={}){let n=l({method:"PUT",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,n)})}patch(e,t){return h(this,arguments,function*(e,t,r={}){let n=l({method:"PATCH",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,n)})}delete(e,t){return h(this,null,function*(){let r={method:"DELETE",headers:this.headers,body:JSON.stringify(t)};return this.fetchRequest(e,r)})}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[860,642,596],()=>r(775));module.exports=n})();