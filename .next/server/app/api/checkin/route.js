"use strict";(()=>{var e={};e.id=967,e.ids=[967],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3263:e=>{e.exports=import("firebase-admin/app")},2929:e=>{e.exports=import("firebase-admin/firestore")},6113:e=>{e.exports=require("crypto")},9550:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>p,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l});var s=r(2411),n=r(7081),o=r(6224),i=r(5467),c=e([i]);i=(c.then?(await c)():c)[0];let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/checkin/route",pathname:"/api/checkin",filename:"route",bundlePath:"app/api/checkin/route"},resolvedPagePath:"C:\\Users\\jaime.andre\\Documents\\As Minhas Formas\\downloads\\gestor-convidados\\app\\api\\checkin\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:h}=u,m="/api/checkin/route";function p(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}a()}catch(e){a(e)}})},5467:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{POST:()=>c});var s=r(3120),n=r(1068),o=r(2135),i=e([n]);async function c(e){try{let{token:t}=await e.json();if(!t)return s.NextResponse.json({error:"Token em falta."},{status:400});let r=await n.i.collection("guests").where("token","==",t).limit(1).get();if(r.empty)return s.NextResponse.json({error:"QR inv\xe1lido ou convidado n\xe3o encontrado."},{status:404});let a=r.docs[0],i=a.data();if(!(0,o.W)(t,i.email).ok)return s.NextResponse.json({error:"Assinatura inv\xe1lida."},{status:403});if("checked_in"===i.status)return s.NextResponse.json({ok:!0,already:!0,id:a.id,guest:i});let c=Date.now();return await a.ref.update({status:"checked_in",checkInAt:c,updatedAt:c}),s.NextResponse.json({ok:!0,id:a.id,checkInAt:c})}catch(e){return console.error(e),s.NextResponse.json({error:e.message||"Falha no check-in."},{status:500})}}n=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},1068:(e,t,r)=>{r.a(e,async(e,a)=>{try{let i;r.d(t,{i:()=>c});var s=r(3263),n=r(2929),o=e([s,n]);if([s,n]=o.then?(await o)():o,(0,s.getApps)().length)i=(0,s.getApps)()[0];else{let e=process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n");process.env.FIREBASE_PROJECT_ID&&process.env.FIREBASE_CLIENT_EMAIL&&e||console.warn("[firebase-admin] Credenciais incompletas. APIs protegidas podem falhar."),i=(0,s.initializeApp)({credential:(0,s.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:e})})}let c=(0,n.getFirestore)(i);a()}catch(e){a(e)}})},2135:(e,t,r)=>{r.d(t,{W:()=>o,f:()=>n});var a=r(6113),s=r.n(a);function n(e,t){let r=process.env.CHECKIN_SECRET||"dev-secret",a=`${e}.${t.toLowerCase()}`,n=s().createHmac("sha256",r).update(a).digest("hex");return`${e}.${n}`}function o(e,t){let[r,a]=e.split(".");if(!r||!a)return{ok:!1,guestId:null};let o=n(r,t).split(".")[1];return{ok:s().timingSafeEqual(Buffer.from(a),Buffer.from(o)),guestId:r}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[860,642],()=>r(9550));module.exports=a})();